<!DOCTYPE html>
<html ng-app="myapp">
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="https://code.angularjs.org/1.3.15/angular.js"></script>
<script src="../build/scripts/ng-map.debug.js"></script>
<script>
  var app = angular.module('myapp', ['ngMap']);
  app.controller('LayerHeatmapCtrl', [ 'NgMapPool', '$timeout', '$scope', function(NgMapPool, $timeout, $scope) {
    var heatmap, vm = this;
    taxiData = [];
    vm.center = { lat: 37.783316, lng: -122.440023 };
    vm.zoom = 15;
    vm.options = {};

    vm.events = [];
    vm.events.push({
      type: 'idle',
      func: function () {


        $scope.$apply(function () {
          vm.data = [
            new google.maps.LatLng(37.782992, -122.442112),
            new google.maps.LatLng(37.783100, -122.441461),
            new google.maps.LatLng(37.783206, -122.440829),
            new google.maps.LatLng(37.783273, -122.440324),
            new google.maps.LatLng(37.783316, -122.440023)
          ];
        })
        console.log('Idle Event', vm.data);
      }
    });

    NgMapPool.getMap('taxiLocations').then(function(map) {
        vm.mainData = [
          new google.maps.LatLng(37.782551, -122.445368),
          new google.maps.LatLng(37.782745, -122.444586),
          new google.maps.LatLng(37.782842, -122.443688),
          new google.maps.LatLng(37.782919, -122.442815),
          new google.maps.LatLng(37.782992, -122.442112),
          new google.maps.LatLng(37.783100, -122.441461),
          new google.maps.LatLng(37.783206, -122.440829),
          new google.maps.LatLng(37.783273, -122.440324),
          new google.maps.LatLng(37.783316, -122.440023),
          new google.maps.LatLng(37.783357, -122.439794),
          new google.maps.LatLng(37.783371, -122.439687),
          new google.maps.LatLng(37.783368, -122.439666),
          new google.maps.LatLng(37.783383, -122.439594),
          new google.maps.LatLng(37.783508, -122.439525)
        ]
        vm.data = vm.mainData;

        $timeout(function () {
          console.log('Clearing data');
          vm.data = [new google.maps.LatLng(37.783368, -122.439666)];
        }, 3000);

        $timeout(function () {
          console.log('Clearing data');
          vm.radius = 5;
          vm.data = [new google.maps.LatLng(37.782842, -122.443688),
          new google.maps.LatLng(37.782919, -122.442815),
          new google.maps.LatLng(37.782992, -122.442112),
          new google.maps.LatLng(37.783100, -122.441461),
          new google.maps.LatLng(37.783206, -122.440829),
          new google.maps.LatLng(37.783273, -122.440324),
          new google.maps.LatLng(37.783316, -122.440023),
          new google.maps.LatLng(37.783357, -122.439794)];
        }, 6000);

        $timeout(function () {
          vm.zoom = 13;
          vm.radius = 30;
        }, 4000);



    });

  }]);
</script>
</head>
<body>
  <style>
    .ngmap{height: 400px;}
    div[ng-controller=LayerHeatmapCtrl] {
      position:relative;
    }
    div[ng-controller=LayerHeatmapCtrl] #panel{
      position: absolute;
      top: 5px;
      left: 50%;
      margin-left: -180px;
      z-index: 5;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #999;
    }
  </style>
  <div ng-controller="LayerHeatmapCtrl as vm">

    <ng-map ngmap-id="taxiLocations" ngmap-class="ngmap" ngmap-center="vm.center" ngmap-zoom="vm.zoom" ngmap-options="vm.options" ngmap-events="vm.events">
      <heatmap-layer ngmap-heatmap-id="foo" ngmap-data="vm.data" radius="vm.radius"></heatmap-layer>
    </ng-map>
  </div>
</body>
</html>
